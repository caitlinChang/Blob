### 性能优化

前端的性能优化大体上分两个层面，加载中和运行时；
加载中的情况一般都是首屏资源加载；

`名词解释`

1. TTI：从资源加载到首次用户可交互的时间

#### 首屏资源加载

首屏加载优化，要根据具体的情况来分析；

##### 1. 信息收集

首先就是要分析一下我们产品的用户群，看看他们使用产品的硬件设备占比和网络情况；

##### 2. 模拟线上

问题：这里的硬件设备具体指什么，怎么模拟？？？
得到硬件配置、网络这些信息后，我们就可以在本地模拟用户的使用环境；

##### 3. 分析和处理

通过 performance 面板分析首页加载的情况，可以看到时间主要是花在什么上面了

1. 加载
   - 如果是加载耗时较长，那就可能是 1. 资源过大，加载慢；2. 服务器响应慢、CDN 响应慢，针对加载阶段的优化就是
     <!-- a. 预加载、预 DNS 解析 这不是首屏加载的范围了，这是次级页面加载的范围，用于处理页面卡顿，模块之间切换慢等 -->
     a. 做好缓存
     - http 缓存
     - service worker 缓存
2. 解析和执行 JS
   - 如果是解析执行 JS 逻辑耗时较长，那就是 首屏加载的 JS 资源太大或者太多
     a. 通过分析网络面板上各个文件的加载时间和体积大小，
     b. 再结合**打包后的模块组成结构分析**，
     c. **剔除无效资源，避免重复打包，精简首屏所需要的资源，将一切不重要的模块拆出来懒加载**。
   - 当然也可能是某段 JS 逻辑比较耗时, 观察 timeline 中的长任务
     a. 定位这个长任务是，将这段 JS 逻辑延后执行、或者放在 worker 中执行
3. 渲染
4. 绘图
   - 如果是渲染和绘图时间长
     a. 可能是触发了多次回流和重绘
     b. 可能是页面的 DOM 结构太多，考虑只渲染可视区域的 DOM

##### 4. 缓存

前端对资源做缓存有两种，http 缓存和 service worker 缓存；
_service worker 会有兼容上的问题，要根据用户设备占比来，它在低版本的 safari 上不支持_
